---
import { Picture } from "astro:assets";
import { formatDate, stripHtml, truncateWords } from "@/helpers";
import type { Post } from "@/types";
import PostCategories from "./PostCategories.astro";

interface Props {
  post: Post;
}

const { post } = Astro.props;
const { title, slug, featured_images, date, category_details, content } = post;

const excerpt = truncateWords(stripHtml(content.rendered), 30);
---

<article
  class="bg-secondary-bg rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition-shadow duration-300 mb-8"
  data-aos="fade-up"
  data-aos-duration="600"
>
  <div class="md:flex">
    {
      featured_images &&
        typeof featured_images === "object" &&
        "full" in featured_images && (
          <div class="md:w-1/3">
            <a href={`/blog/${slug}`}>
              <Picture
                src={featured_images.full.url}
                alt={title.rendered}
                width={400}
                height={300}
                formats={["avif", "webp"]}
                class="w-full h-64 md:h-full object-cover hover:scale-105 transition-transform duration-300"
              />
            </a>
          </div>
        )
    }

    <div
      class={featured_images &&
      typeof featured_images === "object" &&
      "full" in featured_images
        ? "md:w-2/3 p-6 flex flex-col justify-between"
        : "w-full p-6 flex flex-col justify-between"}
    >
      <div>
        <div class="flex gap-2 mb-3 flex-wrap">
          {
            category_details.map((category) => (
              <PostCategories name={category.name} slug={category.slug} />
            ))
          }
        </div>

        <a href={`/blog/${slug}`}>
          <h2
            class="text-2xl md:text-3xl font-bold mb-3 text-white hover:text-accent-gold transition-colors"
          >
            {title.rendered}
          </h2>
        </a>

        <p class="text-gray-400 text-sm mb-4">
          {formatDate(date)}
        </p>

        <p class="text-gray-300 leading-relaxed mb-4">
          {excerpt}
        </p>
      </div>

      <div>
        <a href={`/blog/${slug}`} class="btn-gold inline-block px-6 py-3">
          Leer m√°s
        </a>
      </div>
    </div>
  </div>
</article>
